<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Coloc' Courses ğŸ›’</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Ã‰CRAN 1 â€” LOGIN (choix du pseudo)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-login" class="screen active">
  <div class="login-bg">
    <span class="login-deco deco-1">ğŸ¥¬</span>
    <span class="login-deco deco-2">ğŸ¥•</span>
    <span class="login-deco deco-3">ğŸ‹</span>
    <span class="login-deco deco-4">ğŸ§…</span>
    <span class="login-deco deco-5">ğŸ</span>
    <span class="login-deco deco-6">ğŸ¥¦</span>
  </div>
  <div class="login-card">
    <div class="login-logo">
      <span class="logo-emoji">ğŸ›’</span>
      <h1>Coloc' Courses</h1>
      <p>La liste de courses partagÃ©e de votre coloc'</p>
    </div>
    <div class="login-form">
      <label>Choisissez un avatar</label>
      <div class="avatar-row">
        <button class="avatar-btn active" data-emoji="ğŸ§‘" onclick="selectAvatar(this)">ğŸ§‘</button>
        <button class="avatar-btn" data-emoji="ğŸ‘©" onclick="selectAvatar(this)">ğŸ‘©</button>
        <button class="avatar-btn" data-emoji="ğŸ§”" onclick="selectAvatar(this)">ğŸ§”</button>
        <button class="avatar-btn" data-emoji="ğŸ‘¦" onclick="selectAvatar(this)">ğŸ‘¦</button>
        <button class="avatar-btn" data-emoji="ğŸ‘§" onclick="selectAvatar(this)">ğŸ‘§</button>
        <button class="avatar-btn" data-emoji="ğŸ±" onclick="selectAvatar(this)">ğŸ±</button>
      </div>
      <label>Votre prÃ©nom</label>
      <input type="text" id="login-name" placeholder="Ex : LÃ©a, Tom, Marcâ€¦"
             maxlength="16" autocomplete="off"
             onkeydown="if(event.key==='Enter') doLogin()" />
      <button class="btn-main" onclick="doLogin()">Continuer â†’</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Ã‰CRAN 2 â€” SÃ‰LECTION / CRÃ‰ATION DE COLOC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-coloc" class="screen">
  <div class="coloc-screen-bg"></div>
  <div class="coloc-screen-inner">

    <div class="coloc-header">
      <div class="user-welcome" id="coloc-welcome"></div>
    </div>

    <!-- Onglets CrÃ©er / Rejoindre -->
    <div class="coloc-tabs">
      <button class="coloc-tab active" onclick="switchColocTab('create')">ğŸ  CrÃ©er une coloc</button>
      <button class="coloc-tab"        onclick="switchColocTab('join')">ğŸ”‘ Rejoindre</button>
    </div>

    <!-- Formulaire CrÃ©er -->
    <div class="coloc-panel active" id="panel-create">
      <div class="coloc-emoji-row" id="coloc-emoji-row">
        <button class="coloc-emoji-btn active" data-emoji="ğŸ ">ğŸ </button>
        <button class="coloc-emoji-btn" data-emoji="ğŸ¡">ğŸ¡</button>
        <button class="coloc-emoji-btn" data-emoji="ğŸ¢">ğŸ¢</button>
        <button class="coloc-emoji-btn" data-emoji="ğŸ›–">ğŸ›–</button>
        <button class="coloc-emoji-btn" data-emoji="ğŸ°">ğŸ°</button>
        <button class="coloc-emoji-btn" data-emoji="â›º">â›º</button>
      </div>
      <input type="text" id="coloc-name-input"
             placeholder="Nom de votre coloc (ex: Appart 12B)"
             maxlength="30"
             onkeydown="if(event.key==='Enter') createColoc()" />
      <button class="btn-main" onclick="createColoc()">CrÃ©er la coloc â†’</button>
    </div>

    <!-- Formulaire Rejoindre -->
    <div class="coloc-panel" id="panel-join">
      <p class="panel-hint">Entrez le code fourni par votre colocataire</p>
      <input type="text" id="coloc-code-input"
             placeholder="Ex : SOLEIL-73"
             maxlength="12"
             oninput="this.value = this.value.toUpperCase()"
             onkeydown="if(event.key==='Enter') joinColoc()" />
      <button class="btn-main" onclick="joinColoc()">Rejoindre â†’</button>
    </div>

    <!-- Mes colocs rÃ©centes (localStorage) -->
    <div id="my-colocs-section" style="display:none">
      <div class="my-colocs-title">Mes colocs rÃ©centes</div>
      <div id="my-colocs-list"></div>
    </div>

  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Ã‰CRAN 3 â€” APPLICATION PRINCIPALE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-app" class="screen">

  <!-- â”€â”€ Header â”€â”€ -->
  <header class="app-header">
    <div class="header-brand">
      <span id="header-coloc-emoji">ğŸ </span>
      <span class="brand-name" id="header-coloc-name">Coloc'</span>
    </div>
    <div class="header-center">
      <div class="online-pills" id="online-pills"></div>
    </div>
    <div class="header-right">
      <!-- Code coloc affichÃ© / copiable -->
      <button class="coloc-code-chip" id="coloc-code-chip"
              onclick="copyColocCode()" title="Cliquer pour copier">
        <span id="chip-code">â€”</span>
        <span class="chip-copy">ğŸ“‹</span>
      </button>
      <!-- Bouton switch de coloc -->
      <button class="btn-switch-coloc" onclick="switchColoc()" title="Changer de coloc">
        â‡„
      </button>
      <button class="btn-mode-course" id="btn-mode-course" onclick="toggleModeCourse()">
        <span>ğŸª</span>
        <span class="btn-mode-label">Mode Course</span>
      </button>
      <div class="user-chip" id="user-chip"></div>
    </div>
  </header>

  <!-- â”€â”€ Navigation â”€â”€ -->
  <nav class="app-nav">
    <button class="nav-tab active" data-view="liste" onclick="switchView('liste')">
      ğŸ“‹ Liste
      <span class="nav-badge" id="badge-liste" style="display:none">0</span>
    </button>
    <button class="nav-tab" data-view="chat" onclick="switchView('chat')">
      ğŸ’¬ Chat
      <span class="nav-badge" id="badge-chat" style="display:none">0</span>
    </button>
  </nav>

  <!-- â”€â”€ Contenu â”€â”€ -->
  <main class="app-main">

    <!-- â•â•â•â• VUE LISTE â•â•â•â• -->
    <section class="view active" id="view-liste">

      <!-- Toolbar -->
      <div class="list-toolbar">
        <div class="search-box">
          <span class="search-ico">ğŸ”</span>
          <input type="text" id="search-input"
                 placeholder="Rechercher un articleâ€¦"
                 oninput="debounceSearch()" />
        </div>
        <div class="toolbar-filters">
          <select id="filter-status" onchange="loadItems()">
            <option value="">Tous les articles</option>
            <option value="pending">â³ Ã€ acheter</option>
            <option value="done">âœ… AchetÃ©s</option>
          </select>
          <select id="filter-cat" onchange="loadItems()">
            <option value="">Toutes catÃ©gories</option>
            <option value="Fruits & LÃ©gumes">ğŸ¥¬ Fruits & LÃ©gumes</option>
            <option value="Viandes & Poissons">ğŸ¥© Viandes & Poissons</option>
            <option value="Produits laitiers">ğŸ§€ Produits laitiers</option>
            <option value="Ã‰picerie">ğŸ«™ Ã‰picerie</option>
            <option value="Boissons">ğŸ¥¤ Boissons</option>
            <option value="HygiÃ¨ne">ğŸ§´ HygiÃ¨ne</option>
            <option value="SurgelÃ©s">ğŸ§Š SurgelÃ©s</option>
            <option value="Boulangerie">ğŸ¥– Boulangerie</option>
            <option value="Autre">ğŸ“¦ Autre</option>
          </select>
          <select id="sort-by" onchange="loadItems()">
            <option value="">Par ajout</option>
            <option value="name">A â†’ Z</option>
            <option value="category">CatÃ©gorie</option>
            <option value="urgent">Urgent d'abord</option>
            <option value="dueDate">Date d'Ã©chÃ©ance</option>
          </select>
        </div>
      </div>

      <!-- RÃ©sumÃ© panier -->
      <div class="basket-summary">
        <span id="summary-text">0 article</span>
        <span class="summary-sep">Â·</span>
        <span id="summary-price">0,00 â‚¬</span>
        <span class="summary-sep">Â·</span>
        <span id="summary-done">0 achetÃ©</span>
        <button class="btn-clear-bought" id="btn-clear"
                onclick="clearBought()" style="display:none">
          ğŸ—‘ Vider
        </button>
      </div>

      <!-- Liste des articles -->
      <div id="items-container">
        <div class="empty-list" id="empty-list">
          <div class="empty-emoji">ğŸ§º</div>
          <p>La liste est vide !</p>
          <p class="empty-sub">Ajoutez votre premier article ci-dessous.</p>
        </div>
      </div>

      <!-- Formulaire d'ajout -->
      <div class="add-bar">
        <div class="add-bar-main">
          <input type="text" id="quick-name"
                 placeholder="Ajouter un articleâ€¦" maxlength="60"
                 onkeydown="if(event.key==='Enter') quickAdd()"
                 onfocus="expandAddBar()" />
          <button class="btn-add-quick" onclick="quickAdd()">+</button>
        </div>
        <div class="add-bar-extra" id="add-bar-extra">
          <div class="extra-row">
            <select id="quick-cat">
              <option value="Autre">ğŸ“¦ Autre</option>
              <option value="Fruits & LÃ©gumes">ğŸ¥¬ Fruits & LÃ©gumes</option>
              <option value="Viandes & Poissons">ğŸ¥© Viandes & Poissons</option>
              <option value="Produits laitiers">ğŸ§€ Produits laitiers</option>
              <option value="Ã‰picerie">ğŸ«™ Ã‰picerie</option>
              <option value="Boissons">ğŸ¥¤ Boissons</option>
              <option value="HygiÃ¨ne">ğŸ§´ HygiÃ¨ne</option>
              <option value="SurgelÃ©s">ğŸ§Š SurgelÃ©s</option>
              <option value="Boulangerie">ğŸ¥– Boulangerie</option>
            </select>
            <input type="number" id="quick-qty" value="1" min="0.1" step="0.5" style="width:70px" />
            <select id="quick-unit">
              <option value="pcs">pcs</option>
              <option value="kg">kg</option>
              <option value="g">g</option>
              <option value="L">L</option>
              <option value="cL">cL</option>
              <option value="bouteille">bouteille</option>
              <option value="boÃ®te">boÃ®te</option>
              <option value="sachet">sachet</option>
            </select>
          </div>
          <div class="extra-row">
            <input type="number" id="quick-price" placeholder="Prix (â‚¬)" step="0.01" min="0" style="flex:1" />
            <input type="text"   id="quick-assigned" placeholder="Pour qui ?" maxlength="16" style="flex:1" />
            <input type="date"   id="quick-due" style="flex:1" />
          </div>
          <div class="extra-row">
            <input type="text" id="quick-note" placeholder="Noteâ€¦" maxlength="100" style="flex:1" />
            <label class="urgent-toggle">
              <input type="checkbox" id="quick-urgent" />
              <span>âš¡ Urgent</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Actions en bas de liste -->
      <div class="list-actions-bar">
        <button class="btn-go-shopping" onclick="goShopping()">
          ğŸ›’ Je vais faire les courses !
        </button>
        <!-- NOUVEAU : Bouton de validation de liste -->
        <button class="btn-validate-list" onclick="validateList()">
          âœ… Valider la liste
        </button>
      </div>

    </section>

    <!-- â•â•â•â• VUE CHAT â•â•â•â• -->
    <section class="view" id="view-chat">
      <div class="chat-messages" id="chat-messages"></div>
      <div class="typing-indicator" id="typing-indicator" style="display:none">
        <span id="typing-text"></span>
        <span class="typing-dots"><span></span><span></span><span></span></span>
      </div>
      <div class="chat-input-zone">
        <input type="text" id="chat-input"
               placeholder="Message Ã  la coloc'â€¦" maxlength="300"
               onkeydown="handleChatKeydown(event)"
               oninput="handleTyping()" />
        <button class="btn-send" onclick="sendMessage()">â†’</button>
      </div>
    </section>

  </main>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL â€” Ã‰dition d'un article
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modal-edit" onclick="closeEditModal(event)">
  <div class="modal-box">
    <div class="modal-header">
      <h3>âœï¸ Modifier l'article</h3>
      <button class="modal-close" onclick="closeEditModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="field-group">
        <label>Nom *</label>
        <input type="text" id="edit-name" maxlength="60" />
      </div>
      <div class="field-row">
        <div class="field-group">
          <label>CatÃ©gorie</label>
          <select id="edit-cat">
            <option value="Autre">ğŸ“¦ Autre</option>
            <option value="Fruits & LÃ©gumes">ğŸ¥¬ Fruits & LÃ©gumes</option>
            <option value="Viandes & Poissons">ğŸ¥© Viandes & Poissons</option>
            <option value="Produits laitiers">ğŸ§€ Produits laitiers</option>
            <option value="Ã‰picerie">ğŸ«™ Ã‰picerie</option>
            <option value="Boissons">ğŸ¥¤ Boissons</option>
            <option value="HygiÃ¨ne">ğŸ§´ HygiÃ¨ne</option>
            <option value="SurgelÃ©s">ğŸ§Š SurgelÃ©s</option>
            <option value="Boulangerie">ğŸ¥– Boulangerie</option>
          </select>
        </div>
        <div class="field-group" style="max-width:80px">
          <label>QtÃ©</label>
          <input type="number" id="edit-qty" min="0.1" step="0.5" />
        </div>
        <div class="field-group" style="max-width:110px">
          <label>UnitÃ©</label>
          <select id="edit-unit">
            <option value="pcs">pcs</option>
            <option value="kg">kg</option>
            <option value="g">g</option>
            <option value="L">L</option>
            <option value="cL">cL</option>
            <option value="bouteille">bouteille</option>
            <option value="boÃ®te">boÃ®te</option>
            <option value="sachet">sachet</option>
          </select>
        </div>
      </div>
      <div class="field-row">
        <div class="field-group">
          <label>Prix estimÃ© (â‚¬)</label>
          <input type="number" id="edit-price" step="0.01" min="0" />
        </div>
        <div class="field-group">
          <label>Pour qui ?</label>
          <input type="text" id="edit-assigned" maxlength="16" />
        </div>
      </div>
      <div class="field-row">
        <div class="field-group">
          <label>Date d'Ã©chÃ©ance</label>
          <input type="date" id="edit-due" />
        </div>
        <div class="field-group">
          <label>Note</label>
          <input type="text" id="edit-note" maxlength="100" />
        </div>
      </div>
      <div class="field-group">
        <label class="urgent-toggle big">
          <input type="checkbox" id="edit-urgent" />
          <span>âš¡ Urgent</span>
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeEditModal()">Annuler</button>
      <button class="btn-main" onclick="saveEdit()">Enregistrer</button>
    </div>
  </div>
</div>

<!-- MODAL â€” Confirmation validation liste -->
<div class="modal-overlay" id="modal-validate" onclick="closeValidateModal(event)">
  <div class="modal-box modal-box--small">
    <div class="modal-header">
      <h3>âœ… Valider la liste</h3>
      <button class="modal-close" onclick="closeValidateModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="validate-info" id="validate-info"></div>
      <p class="validate-warning">
        Les articles <strong>achetÃ©s</strong> seront supprimÃ©s dÃ©finitivement.<br/>
        Les articles <strong>non achetÃ©s</strong> resteront dans la liste.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeValidateModal()">Annuler</button>
      <button class="btn-validate-confirm" onclick="confirmValidation()">
        âœ… Confirmer la validation
      </button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="/socket.io/socket.io.js"></script>
<script src="app.js"></script>
</body>
</html>
